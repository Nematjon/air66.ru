Date.ext={};Date.ext.util={};Date.ext.util.xPad=function(x,pad,r){if(typeof(r)=="undefined"){r=10}for(;parseInt(x,10)<r&&r>1;r/=10){x=pad.toString()+x}return x.toString()};Date.prototype.locale="en-GB";if(document.getElementsByTagName("html")&&document.getElementsByTagName("html")[0].lang){Date.prototype.locale=document.getElementsByTagName("html")[0].lang}Date.ext.locales={};Date.ext.locales.en={a:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],A:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],B:["January","February","March","April","May","June","July","August","September","October","November","December"],c:"%a %d %b %Y %T %Z",p:["AM","PM"],P:["am","pm"],x:"%d/%m/%y",X:"%T"};Date.ext.locales["en-US"]=Date.ext.locales.en;Date.ext.locales["en-US"].c="%a %d %b %Y %r %Z";Date.ext.locales["en-US"].x="%D";Date.ext.locales["en-US"].X="%r";Date.ext.locales["en-GB"]=Date.ext.locales.en;Date.ext.locales["en-AU"]=Date.ext.locales["en-GB"];Date.ext.formats={a:function(d){return Date.ext.locales[d.locale].a[d.getDay()]},A:function(d){return Date.ext.locales[d.locale].A[d.getDay()]},b:function(d){return Date.ext.locales[d.locale].b[d.getMonth()]},B:function(d){return Date.ext.locales[d.locale].B[d.getMonth()]},c:"toLocaleString",C:function(d){return Date.ext.util.xPad(parseInt(d.getFullYear()/100,10),0)},d:["getDate","0"],e:["getDate"," "],g:function(d){return Date.ext.util.xPad(parseInt(Date.ext.util.G(d)/100,10),0)},G:function(d){var y=d.getFullYear();var V=parseInt(Date.ext.formats.V(d),10);var W=parseInt(Date.ext.formats.W(d),10);if(W>V){y++}else{if(W===0&&V>=52){y--}}return y},H:["getHours","0"],I:function(d){var I=d.getHours()%12;return Date.ext.util.xPad(I===0?12:I,0)},j:function(d){var ms=d-new Date(""+d.getFullYear()+"/1/1 GMT");ms+=d.getTimezoneOffset()*60000;var doy=parseInt(ms/60000/60/24,10)+1;return Date.ext.util.xPad(doy,0,100)},m:function(d){return Date.ext.util.xPad(d.getMonth()+1,0)},M:["getMinutes","0"],p:function(d){return Date.ext.locales[d.locale].p[d.getHours()>=12?1:0]},P:function(d){return Date.ext.locales[d.locale].P[d.getHours()>=12?1:0]},S:["getSeconds","0"],u:function(d){var dow=d.getDay();return dow===0?7:dow},U:function(d){var doy=parseInt(Date.ext.formats.j(d),10);var rdow=6-d.getDay();var woy=parseInt((doy+rdow)/7,10);return Date.ext.util.xPad(woy,0)},V:function(d){var woy=parseInt(Date.ext.formats.W(d),10);var dow1_1=(new Date(""+d.getFullYear()+"/1/1")).getDay();var idow=woy+(dow1_1>4||dow1_1<=1?0:1);if(idow==53&&(new Date(""+d.getFullYear()+"/12/31")).getDay()<4){idow=1}else{if(idow===0){idow=Date.ext.formats.V(new Date(""+(d.getFullYear()-1)+"/12/31"))}}return Date.ext.util.xPad(idow,0)},w:"getDay",W:function(d){var doy=parseInt(Date.ext.formats.j(d),10);var rdow=7-Date.ext.formats.u(d);var woy=parseInt((doy+rdow)/7,10);return Date.ext.util.xPad(woy,0,10)},y:function(d){return Date.ext.util.xPad(d.getFullYear()%100,0)},Y:"getFullYear",z:function(d){var o=d.getTimezoneOffset();var H=Date.ext.util.xPad(parseInt(Math.abs(o/60),10),0);var M=Date.ext.util.xPad(o%60,0);return(o>0?"-":"+")+H+M},Z:function(d){return d.toString().replace(/^.*\(([^)]+)\)$/,"$1")},"%":function(d){return"%"}};Date.ext.aggregates={c:"locale",D:"%m/%d/%y",h:"%b",n:"\n",r:"%I:%M:%S %p",R:"%H:%M",t:"\t",T:"%H:%M:%S",x:"locale",X:"locale"};Date.ext.aggregates.z=Date.ext.formats.z(new Date());Date.ext.aggregates.Z=Date.ext.formats.Z(new Date());Date.ext.unsupported={};Date.prototype.strftime=function(fmt){if(!(this.locale in Date.ext.locales)){if(this.locale.replace(/-[a-zA-Z]+$/,"")in Date.ext.locales){this.locale=this.locale.replace(/-[a-zA-Z]+$/,"")}else{this.locale="en-GB"}}var d=this;while(fmt.match(/%[cDhnrRtTxXzZ]/)){fmt=fmt.replace(/%([cDhnrRtTxXzZ])/g,function(m0,m1){var f=Date.ext.aggregates[m1];return(f=="locale"?Date.ext.locales[d.locale][m1]:f)})}var str=fmt.replace(/%([aAbBCdegGHIjmMpPSuUVwWyY%])/g,function(m0,m1){var f=Date.ext.formats[m1];if(typeof(f)=="string"){return d[f]()}else{if(typeof(f)=="function"){return f.call(d,d)}else{if(typeof(f)=="object"&&typeof(f[0])=="string"){return Date.ext.util.xPad(d[f[0]](),f[1])}else{return m1}}}});d=null;return str};Tickets.utils.formatDate=function(string){if(string&&string!='0000-00-00 00:00:00'&&string!='-1-11-30 00:00:00'&&string!=0){var date=/^[0-9]+$/.test(string)?new Date(string*1000):new Date(string.replace(/(\d+)-(\d+)-(\d+)/,'$2/$3/$1'));return date.strftime(MODx.config['tickets.date_format']);}
else{return'&nbsp;';}};Tickets.utils.userLink=function(value,id){if(!value){return'';}
else if(!id){return value;}
var action=MODx.action?MODx.action['security/user/update']:'security/user/update';var url='index.php?a='+action+'&id='+id;return'<a href="'+url+'" target="_blank" class="tickets-link">'+value+'</a>'};Tickets.utils.ticketLink=function(value,id,blank){if(!value){return'';}
else if(!id){return value;}
var action=MODx.action?MODx.action['resource/update']:'resource/update';var url='index.php?a='+action+'&id='+id;return blank?'<a href="'+url+'" class="tickets-link" target="_blank">'+value+'</a>':'<a href="'+url+'" class="tickets-link">'+value+'</a>';};Tickets.utils.getMenu=function(actions,grid,selected){var menu=[];var cls,icon,title,action='';var has_delete=false;for(var i in actions){if(!actions.hasOwnProperty(i)){continue;}
var a=actions[i];if(!a['menu']){if(a=='-'){menu.push('-');}
continue;}
else if(menu.length>0&&!has_delete&&(/^remove/i.test(a['action'])||/^delete/i.test(a['action']))){menu.push('-');has_delete=true;}
if(selected.length>1){if(!a['multiple']){continue;}
else if(typeof(a['multiple'])=='string'){a['title']=a['multiple'];}}
cls=a['cls']?a['cls']:'';icon=a['icon']?a['icon']:'';title=a['title']?a['title']:a['title'];action=a['action']?grid[a['action']]:'';menu.push({handler:action,text:String.format('<span class="{0}"><i class="x-menu-item-icon {1}"></i>{2}</span>',cls,icon,title),});}
return menu;};Tickets.utils.renderActions=function(value,props,row){var res=[];var cls,icon,title,action,item='';for(var i in row.data.actions){if(!row.data.actions.hasOwnProperty(i)){continue;}
var a=row.data.actions[i];if(!a['button']){continue;}
cls=a['cls']?a['cls']:'';icon=a['icon']?a['icon']:'';action=a['action']?a['action']:'';title=a['title']?a['title']:'';item=String.format('<li class="{0}"><button class="btn btn-default {1}" action="{2}" title="{3}"></button></li>',cls,icon,action,title);res.push(item);}
return String.format('<ul class="tickets-row-actions">{0}</ul>',res.join(''));};;Tickets.combo.User=function(config){config=config||{};Ext.applyIf(config,{name:'user',fieldLabel:config.name||'createdby',hiddenName:config.name||'createdby',displayField:'username',valueField:'id',anchor:'99%',fields:['username','id','fullname'],pageSize:20,url:MODx.modx23?MODx.config.connector_url:MODx.config.connectors_url+'security/user.php',typeAhead:false,editable:true,allowBlank:false,baseParams:{action:MODx.modx23?'security/user/getlist':'getlist',combo:1,id:config.value},tpl:new Ext.XTemplate('\
   <tpl for=".">\
    <div class="x-combo-list-item tickets-list-item">\
     <span>\
      <small>({id})</small>\
      <b>{username}</b>\
      <tpl if="fullname"> - {fullname}</tpl>\
     </span>\
    </div>\
   </tpl>',{compiled:true}),});Tickets.combo.User.superclass.constructor.call(this,config);};Ext.extend(Tickets.combo.User,MODx.combo.ComboBox);Ext.reg('tickets-combo-user',Tickets.combo.User);MODx.combo.TicketsSection=function(config){config=config||{};Ext.applyIf(config,{fieldLabel:_('resource_parent'),description:'<b>[[*parent]]</b><br />'+_('resource_parent_help'),fields:['id','pagetitle','parents'],valueField:'id',displayField:'pagetitle',name:'parent-cmb',hiddenName:'parent-cmp',url:Tickets.config.connector_url,baseParams:{action:'mgr/section/getlist',combo:1,id:config.value},pageSize:10,width:300,typeAhead:false,editable:true,allowBlank:false,tpl:new Ext.XTemplate('\
   <tpl for=".">\
    <div class="x-combo-list-item tickets-list-item">\
     <tpl if="parents">\
      <span class="parents">\
       <tpl for="parents">\
        <nobr>{pagetitle} / </nobr>\
       </tpl>\
      </span>\
     </tpl>\
     <span>\
      <small>({id})</small>\
      <b>{pagetitle}</b>\
     </span>\
    </div>\
   </tpl>',{compiled:true}),});MODx.combo.TicketsSection.superclass.constructor.call(this,config);};Ext.extend(MODx.combo.TicketsSection,MODx.combo.ComboBox);Ext.reg('tickets-combo-section',MODx.combo.TicketsSection);Tickets.combo.TicketThread=function(config){config=config||{};Ext.applyIf(config,{fieldLabel:_('ticket_thread'),fields:['id','name','pagetitle'],valueField:'id',displayField:'name',name:'thread',hiddenName:'thread',url:Tickets.config.connector_url,baseParams:{action:'mgr/thread/getlist',combo:1,id:config.value},pageSize:10,width:300,typeAhead:false,editable:true,allowBlank:false,tpl:new Ext.XTemplate('\
   <tpl for=".">\
    <div class="x-combo-list-item tickets-list-item">\
     <span>\
      <small>({id})</small>\
      <b>{name}</b> - {pagetitle}\
     </span>\
    </div>\
   </tpl>',{compiled:true}),});Tickets.combo.TicketThread.superclass.constructor.call(this,config);};Ext.extend(Tickets.combo.TicketThread,MODx.combo.ComboBox);Ext.reg('tickets-combo-thread',Tickets.combo.TicketThread);Tickets.combo.Template=function(config){config=config||{};Ext.applyIf(config,{name:'properties[tickets][template]',hiddenName:'properties[tickets][template]',url:MODx.modx23?MODx.config.connector_url:MODx.config.connectors_url+'element/template.php',baseParams:{action:MODx.modx23?'element/template/getlist':'getlist',combo:1,}});Tickets.combo.Template.superclass.constructor.call(this,config);};Ext.extend(Tickets.combo.Template,MODx.combo.Template);Ext.reg('tickets-children-combo-template',Tickets.combo.Template);Tickets.combo.Search=function(config){config=config||{};Ext.applyIf(config,{xtype:'twintrigger',ctCls:'x-field-search',allowBlank:true,msgTarget:'under',emptyText:_('search'),name:'query',triggerAction:'all',clearBtnCls:'x-field-search-clear',searchBtnCls:'x-field-search-go',onTrigger1Click:this._triggerSearch,onTrigger2Click:this._triggerClear,});Tickets.combo.Search.superclass.constructor.call(this,config);this.on('render',function(){this.getEl().addKeyListener(Ext.EventObject.ENTER,function(){this._triggerSearch();},this);});this.addEvents('clear','search');};Ext.extend(Tickets.combo.Search,Ext.form.TwinTriggerField,{initComponent:function(){Ext.form.TwinTriggerField.superclass.initComponent.call(this);this.triggerConfig={tag:'span',cls:'x-field-search-btns',cn:[{tag:'div',cls:'x-form-trigger '+this.searchBtnCls},{tag:'div',cls:'x-form-trigger '+this.clearBtnCls}]};},_triggerSearch:function(){this.fireEvent('search',this);},_triggerClear:function(){this.fireEvent('clear',this);},});Ext.reg('tickets-field-search',Tickets.combo.Search);;Tickets.panel.Comments=function(config){config=config||{};Ext.applyIf(config,{layout:'anchor',border:false,anchor:'100%',items:[{xtype:'tickets-grid-comments',cls:'main-wrapper',section:config.section||0,parents:config.parents||0,threads:config.threads||0,}],cls:MODx.modx23?'modx23':'modx22',});Tickets.panel.Comments.superclass.constructor.call(this,config);};Ext.extend(Tickets.panel.Comments,MODx.Panel);Ext.reg('tickets-panel-comments',Tickets.panel.Comments);;Tickets.grid.Comments=function(config){config=config||{};Ext.applyIf(config,{url:Tickets.config.connector_url,baseParams:{action:'mgr/comment/getlist',section:config.section,parents:config.parents,threads:config.threads,},fields:this.getFields(),columns:this.getColumns(config),tbar:this.getTopBar(config),listeners:this.getListeners(config),sm:new Ext.grid.CheckboxSelectionModel(),autoHeight:true,paging:true,remoteSort:true,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,getRowClass:function(rec,ri,p){var cls=[];if(!rec.data.published){cls.push('tickets-row-unpublished');}
if(rec.data.deleted){cls.push('tickets-row-deleted');}
return cls.join(' ');},},stateful:true,stateId:'tickets-comments-state',});Tickets.grid.Comments.superclass.constructor.call(this,config);this.getStore().sortInfo={field:'createdon',direction:'DESC'};};Ext.extend(Tickets.grid.Comments,MODx.grid.Grid,{getFields:function(config){return['id','text','name','parent','email','ip','thread_name','createdby','createdon','editedon','editedby','deletedon','deletedby','published','deleted','resource','pagetitle','preview_url','actions',];},getColumns:function(config){return[{header:_('id'),dataIndex:'id',width:35,sortable:true,},{header:_('ticket_comment_text'),dataIndex:'text',width:100,sortable:true},{header:_('ticket_comment_name'),dataIndex:'name',sortable:true,width:75,renderer:function(value,metaData,record){return Tickets.utils.userLink(value,record['data']['createdby'])},},{header:_('ticket_comment_createdon'),dataIndex:'createdon',width:75,sortable:true,renderer:Tickets.utils.formatDate},{header:_('ticket'),dataIndex:'pagetitle',width:75,sortable:true,renderer:function(value,metaData,record){return Tickets.utils.ticketLink(value,record['data']['resource'],true)},hidden:config.parents||config.threads?1:0},{header:_('ticket_comment_thread'),dataIndex:'thread_name',width:75,sortable:true,hidden:config.threads!=''&&config.threads!=0,},{header:_('ticket_actions'),dataIndex:'actions',renderer:Tickets.utils.renderActions,sortable:false,width:75,id:'actions'}];},getTopBar:function(config){return['->',{xtype:'tickets-field-search',width:250,listeners:{search:{fn:function(field){this._doSearch(field);},scope:this},clear:{fn:function(field){field.setValue('');this._clearSearch();},scope:this},}}];},getListeners:function(config){return{rowDblClick:function(grid,rowIndex,e){var row=grid.store.getAt(rowIndex);this.editComment(grid,e,row);}};},getMenu:function(grid,rowIndex){var ids=this._getSelectedIds();var row=grid.getStore().getAt(rowIndex);var menu=Tickets.utils.getMenu(row.data['actions'],this,ids);this.addContextMenuItem(menu);},onClick:function(e){var elem=e.getTarget();if(elem.nodeName=='BUTTON'){var row=this.getSelectionModel().getSelected();if(typeof(row)!='undefined'){var action=elem.getAttribute('action');if(action=='showMenu'){var ri=this.getStore().find('id',row.id);return this._showMenu(this,ri,e);}
else if(typeof this[action]==='function'){this.menu.record=row.data;return this[action](this,e);}}}
return this.processEvent('click',e);},_doSearch:function(tf){this.getStore().baseParams.query=tf.getValue();this.getBottomToolbar().changePage(1);},_clearSearch:function(){this.getStore().baseParams.query='';this.getBottomToolbar().changePage(1);},editComment:function(btn,e,row){var record=typeof(row)!='undefined'?row.data:this.menu.record;MODx.Ajax.request({url:Tickets.config.connector_url,params:{action:'mgr/comment/get',id:record.id,},listeners:{success:{fn:function(r){var record=r.object;var w=MODx.load({xtype:'tickets-window-comment-update',record:record,listeners:{success:{fn:this.refresh,scope:this},},});w.fp.getForm().reset();w.fp.getForm().setValues(record);w.show(e.target);},scope:this}}});},viewComment:function(btn,e){window.open(this.menu.record['preview_url']+'#comment-'+this.menu.record['id']);return false;},commentAction:function(method){var ids=this._getSelectedIds();if(!ids.length){return false;}
MODx.Ajax.request({url:Tickets.config.connector_url,params:{action:'mgr/comment/multiple',method:method,ids:Ext.util.JSON.encode(ids),},listeners:{success:{fn:function(){this.refresh();},scope:this},failure:{fn:function(response){MODx.msg.alert(_('error'),response.message);},scope:this},}})},publishComment:function(btn,e){this.commentAction('publish');},unpublishComment:function(btn,e){this.commentAction('unpublish');},deleteComment:function(btn,e){this.commentAction('delete');},undeleteComment:function(btn,e){this.commentAction('undelete');},removeComment:function(){Ext.MessageBox.confirm(_('ticket_comment_remove'),_('ticket_comment_remove_confirm'),function(val){if(val=='yes'){this.commentAction('remove');}},this);},_getSelectedIds:function(){var ids=[];var selected=this.getSelectionModel().getSelections();for(var i in selected){if(!selected.hasOwnProperty(i)){continue;}
ids.push(selected[i]['id']);}
return ids;},remove:function(){},});Ext.reg('tickets-grid-comments',Tickets.grid.Comments);;Tickets.window.UpdateComment=function(config){config=config||{};Ext.applyIf(config,{title:_('tickets_comment_update'),url:Tickets.config.connector_url,action:'mgr/comment/update',fields:this.getFields(config),keys:this.getKeys(config),width:700,height:550,layout:'anchor',autoHeight:false,cls:'tickets-window '+(MODx.modx23?'modx23':'modx22'),});Tickets.window.UpdateComment.superclass.constructor.call(this,config);};Ext.extend(Tickets.window.UpdateComment,MODx.Window,{getKeys:function(){return[{key:Ext.EventObject.ENTER,shift:true,fn:this.submit,scope:this}];},getFields:function(config){return[{xtype:'hidden',name:'id',},{xtype:'textarea',fieldLabel:_('comment'),name:'text',anchor:'99% -210'},{items:[{layout:'form',cls:'modx-panel',items:[{layout:'column',border:false,items:[{columnWidth:.5,border:false,layout:'form',items:this.getLeftFields(config),},{columnWidth:.5,border:false,layout:'form',cls:'right-column',items:this.getRightFields(config),}]}]}]}];},getLeftFields:function(config){return[{xtype:'textfield',fieldLabel:_('ticket_comment_name'),name:'name',anchor:'99%',disabled:config.record.createdby!=0},{xtype:'numberfield',fieldLabel:_('ticket_comment_parent'),name:'parent',anchor:'75%'},{xtype:'tickets-combo-thread',fieldLabel:_('ticket_thread'),name:'thread',anchor:'75%'}];},getRightFields:function(config){return[{xtype:'textfield',fieldLabel:_('ticket_comment_email'),name:'email',anchor:'99%',disabled:config.record.createdby!=0},{layout:'column',border:false,items:[{columnWidth:.5,border:false,layout:'form',items:[{xtype:'displayfield',fieldLabel:_('ticket_comment_createdon'),name:'createdon',anchor:'99%',},{xtype:'displayfield',fieldLabel:'IP',name:'ip',anchor:'99%',}]},{columnWidth:.5,border:false,layout:'form',cls:'right-column',items:[{xtype:'displayfield',fieldLabel:_('ticket_comment_editedon'),name:'editedon',anchor:'99%',},{xtype:'displayfield',fieldLabel:_('ticket_comment_deletedon'),name:'deletedon',anchor:'99%',}]}]}];}});Ext.reg('tickets-window-comment-update',Tickets.window.UpdateComment);;miniShop2.page.UpdateCategory=function(config){config=config||{record:{}};config.record=config.record||{};Ext.applyIf(config,{panelXType:'minishop2-panel-category-update',actions:{'new':MODx.action?MODx.action['resource/create']:'resource/create',edit:MODx.action?MODx.action['resource/update']:'resource/update',preview:MODx.action?MODx.action['resource/preview']:'resource/preview'}});miniShop2.page.UpdateCategory.superclass.constructor.call(this,config);};Ext.extend(miniShop2.page.UpdateCategory,MODx.page.UpdateResource,{getButtons:function(cfg){var btns=[];if(cfg.canSave==1){btns.push({process:MODx.modx23?'resource/update':'update',text:'<i class="'+(MODx.modx23?'icon icon-check':'bicon-ok')+'"></i> '+_('ms2_btn_save'),method:'remote',checkDirty:cfg.richtext||MODx.request.activeSave==1?false:true,cls:'primary-button',keys:[{key:MODx.config.keymap_save||'s',ctrl:true}]});btns.push('-');}else if(cfg.locked){btns.push({text:cfg.lockedText||_('locked'),handler:Ext.emptyFn,disabled:true});btns.push('-');}
btns.push({text:'<i class="'+(MODx.modx23?'icon icon-power-off':'bicon-off')+'"></i> '+_('ms2_btn_publish'),id:'minishop2-panel-btn-publish',handler:this.publishProduct,hidden:!cfg.canPublish||cfg.record.published,disabled:cfg.locked,scope:this,cls:'btn-orange'});btns.push({text:'<i class="'+(MODx.modx23?'icon icon-power-off':'bicon-off')+'"></i> '+_('ms2_btn_unpublish'),id:'minishop2-panel-btn-unpublish',handler:this.unpublishProduct,hidden:!cfg.canPublish||!cfg.record.published,disabled:cfg.locked,scope:this});btns.push('-');btns.push({text:'<i class="'+(MODx.modx23?'icon icon-trash-o':'bicon-trash')+'"></i> '+_('ms2_btn_delete'),id:'minishop2-panel-btn-delete',handler:this.deleteProduct,hidden:!cfg.canDelete||cfg.record.deleted,disabled:cfg.locked,scope:this,cls:'btn-brown'});btns.push({text:'<i class="'+(MODx.modx23?'icon icon-trash-o':'bicon-trash')+'"></i> '+_('ms2_btn_undelete'),id:'minishop2-panel-btn-undelete',handler:this.undeleteProduct,hidden:!cfg.canDelete||!cfg.record.deleted,disabled:cfg.locked,scope:this,cls:'btn-green'});btns.push('-');btns.push({text:'<i class="'+(MODx.modx23?'icon icon-eye':'bicon-eye-open')+'"></i> '+_('ms2_btn_view'),handler:this.preview,scope:this});btns.push('-');btns.push({text:'<i class="'+(MODx.modx23?'icon icon-copy':'bicon-file')+'"></i>',handler:this.duplicateResource,scope:this,tooltip:_('ms2_btn_duplicate')});btns.push('-');btns.push({text:'<i class="'+(MODx.modx23?'icon icon-arrow-left':'bicon-arrow-left')+'"></i>',handler:this.prevPage,disabled:!cfg.prev_page?1:0,scope:this,tooltip:_('ms2_btn_prev'),keys:[{key:37,alt:true,scope:this,fn:this.prevPage}]});btns.push({text:'<i class="'+(MODx.modx23?'icon icon-arrow-up':'bicon-arrow-up')+'"></i>',handler:this.upPage,scope:this,tooltip:_('ms2_btn_back'),keys:[{key:38,alt:true,scope:this,fn:this.upPage}]});btns.push({text:'<i class="'+(MODx.modx23?'icon icon-arrow-right':'bicon-arrow-right')+'"></i>',handler:this.nextPage,disabled:!cfg.next_page?1:0,scope:this,tooltip:_('ms2_btn_next'),keys:[{key:39,alt:true,scope:this,fn:this.nextPage}]});return btns;},publishProduct:function(btn,e){var key=this.record.context_key+'_'+this.record.id;MODx.Ajax.request({url:miniShop2.config.connector_url,params:{action:'mgr/product/publish',id:this.record.id},listeners:{'success':{fn:function(r){var bp=Ext.getCmp('minishop2-panel-btn-publish');if(bp){bp.hide();}
var bu=Ext.getCmp('minishop2-panel-btn-unpublish');if(bu){bu.show();}
var p=Ext.getCmp('modx-resource-published');if(p){p.setValue(1);}
var po=Ext.getCmp('modx-resource-publishedon');if(po){po.setValue(r.object.publishedon);}
var tree=Ext.getCmp('modx-resource-tree');if(tree){tree.refreshNode(key,false);}},scope:this}}});},unpublishProduct:function(btn,e){var key=this.record.context_key+'_'+this.record.id;MODx.Ajax.request({url:miniShop2.config.connector_url,params:{action:'mgr/product/unpublish',id:this.record.id},listeners:{'success':{fn:function(r){var bp=Ext.getCmp('minishop2-panel-btn-publish');if(bp){bp.show();}
var bu=Ext.getCmp('minishop2-panel-btn-unpublish');if(bu){bu.hide();}
var p=Ext.getCmp('modx-resource-published');if(p){p.setValue(0);}
var po=Ext.getCmp('modx-resource-publishedon');if(po){po.setValue('');}
var tree=Ext.getCmp('modx-resource-tree');if(tree){tree.refreshNode(key,false);}},scope:this}}});},deleteProduct:function(btn,e){var key=this.record.context_key+'_'+this.record.id;MODx.Ajax.request({url:miniShop2.config.connector_url,params:{action:'mgr/product/delete',id:this.record.id},listeners:{success:{fn:function(r){var bd=Ext.getCmp('minishop2-panel-btn-delete');if(bd){bd.hide();}
var bu=Ext.getCmp('minishop2-panel-btn-undelete');if(bu){bu.show();}
var d=Ext.getCmp('modx-resource-deleted');if(d){d.setValue(1);}
var dd=Ext.getCmp('modx-resource-deletedon');if(dd){dd.setValue(r.object.deletedon);}
var tree=Ext.getCmp('modx-resource-tree');if(tree){tree.refreshNode(key,false);}},scope:this}}});},undeleteProduct:function(btn,e){var key=this.record.context_key+'_'+this.record.id;MODx.Ajax.request({url:miniShop2.config.connector_url,params:{action:'mgr/product/undelete',id:this.record.id},listeners:{success:{fn:function(r){var bd=Ext.getCmp('minishop2-panel-btn-delete');if(bd){bd.show();}
bu=Ext.getCmp('minishop2-panel-btn-undelete').show();if(bu){bu.hide();}
var d=Ext.getCmp('modx-resource-deleted');if(d){d.setValue(0);}
var dd=Ext.getCmp('modx-resource-deletedon');if(dd){dd.setValue('');}
var tree=Ext.getCmp('modx-resource-tree');if(tree){tree.refreshNode(key,false);}},scope:this}}});},loadHelpPane:function(b){var url=MODx.config.help_url;if(!url){return false;}
MODx.helpWindow=new Ext.Window({title:_('help'),width:850,height:500,resizable:true,maximizable:true,modal:false,layout:'fit',html:'<iframe src="'+url+'" width="100%" height="100%" frameborder="0"></iframe>'});MODx.helpWindow.show(b);return true;},prevPage:function(btn,e){if(this.prev_page>0){var updatePage=MODx.action?MODx.action['resource/update']:'resource/update';var id=this.prev_page;MODx.releaseLock(MODx.request.id);MODx.sleep(400);MODx.loadPage(updatePage,'id='+id)}},nextPage:function(btn,e){if(this.next_page>0){var updatePage=MODx.action?MODx.action['resource/update']:'resource/update';var id=this.next_page;MODx.releaseLock(MODx.request.id);MODx.sleep(400);MODx.loadPage(updatePage,'id='+id)}},upPage:function(btn,e){var id=this.up_page;if(id!=0){var upPage=MODx.action?MODx.action['resource/update']:'resource/update';}
else{var upPage=MODx.action['welcome'];}
MODx.releaseLock(MODx.request.id);MODx.sleep(400);MODx.loadPage(upPage,'id='+id)}});Ext.reg('minishop2-page-category-update',miniShop2.page.UpdateCategory);miniShop2.panel.UpdateCategory=function(config){config=config||{};miniShop2.panel.UpdateCategory.superclass.constructor.call(this,config);};Ext.extend(miniShop2.panel.UpdateCategory,MODx.panel.Resource,{getFields:function(config){var it=[];it.push({title:_('ms2_category'),id:'modx-resource-settings',cls:'modx-resource-tab',layout:'form',labelAlign:'top',labelSeparator:'',bodyCssClass:'tab-panel-wrapper main-wrapper',autoHeight:true,defaults:{border:false,msgTarget:'side',width:400},items:this.getMainFields(config)});it.push({title:_('settings'),id:'modx-minishop2-template',cls:'modx-resource-tab',layout:'form',labelAlign:'top',labelSeparator:'',bodyCssClass:'tab-panel-wrapper main-wrapper',autoHeight:true,defaults:{border:false,msgTarget:'side',width:400},items:this.getTemplateSettings(config)});if(miniShop2.config.show_comments){it.push({title:_('comments'),items:this.getComments(config)});}
if(config.show_tvs&&MODx.config.tvs_below_content!=1){it.push(this.getTemplateVariablesPanel(config));}
if(MODx.perm.resourcegroup_resource_list==1){it.push(this.getAccessPermissionsTab(config));}
var its=[];its.push(this.getPageHeader(config),{id:'modx-resource-tabs',xtype:'modx-tabs',forceLayout:true,deferredRender:false,collapsible:true,itemId:'tabs',stateful:MODx.config.ms2_category_remember_tabs==true,stateId:'minishop2-category-upd-tabpanel',stateEvents:['tabchange'],getState:function(){return{activeTab:this.items.indexOf(this.getActiveTab())};},items:it});var ct=this.getProducts(config);if(ct){its.push(miniShop2.PanelSpacer);its.push(ct);its.push(miniShop2.PanelSpacer);}
if(MODx.config.tvs_below_content==1){var tvs=this.getTemplateVariablesPanel(config);tvs.style='margin-top: 10px';its.push(tvs);}
return its;},getProducts:function(config){return[{xtype:'minishop2-grid-category',resource:config.resource,border:false}];},getTemplateSettings:function(config){return[{xtype:'minishop2-tab-template-settings',record:config.record,mode:"update"}];},getComments:function(config){return[{xtype:'tickets-panel-comments',record:config.record,section:config.record.id,layout:'form'}];},templateWarning:function(){var t=Ext.getCmp('modx-resource-template');if(!t){return false;}
if(t.getValue()!==t.originalValue){Ext.Msg.confirm(_('warning'),_('resource_change_template_confirm'),function(e){if(e=='yes'){var nt=t.getValue();var f=Ext.getCmp('modx-page-update-resource');f.config.action=MODx.modx23?'resource/reload':'reload';MODx.activePage.submitForm({success:{fn:function(r){var page=MODx.action?MODx.action[r.result.object.action]:r.result.object.action;MODx.loadPage(page,'id='+r.result.object.id+'&reload='+r.result.object.reload+'&class_key='+this.config.record.class_key);},scope:this}},{bypassValidCheck:true},{reloadOnly:true});}else{t.setValue(this.config.record.template);}},this);}
return true;}});Ext.reg('minishop2-panel-category-update',miniShop2.panel.UpdateCategory);